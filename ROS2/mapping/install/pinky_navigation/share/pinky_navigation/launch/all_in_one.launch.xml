<?xml version="1.0"?>
<launch>
  <arg name="world_name" default="pinky_fp.world"/>
  <arg name="world" default="$(find-pkg-share pinky_gazebo)/worlds/$(var world_name)"/>
  <arg name="bridge_params" default="$(find-pkg-share pinky_gazebo)/params/pinky_bridge.yaml"/>

  <set_env name="GZ_SIM_RESOURCE_PATH"
           value="$(find-pkg-share pinky_description)/../:/$(find-pkg-share pinky_gazebo)/models"/>

  <include file="$(find-pkg-share ros_gz_sim)/launch/gz_sim.launch.py">
    <arg name="gz_args" value="-r -s -v4 $(var world)"/>
    <arg name="on_exit_shutdown" value="true"/>
  </include>

  <include file="$(find-pkg-share ros_gz_sim)/launch/gz_sim.launch.py">
    <arg name="gz_args" value="-g -v4"/>
  </include>

  <!-- Robot 1 -->
  <group>
    <arg name="robot_name" default="pinky1"/>
    <push-ros-namespace ns="$(var robot_name)"/>

    <include file="$(find-pkg-share pinky_description)/launch/upload.launch.xml">
      <arg name="use_sim_time" value="True"/>
      <arg name="robot_name" value="$(var robot_name)"/>
      <arg name="tf_prefix"   value="$(var robot_name)"/>
    </include>

    <node pkg="ros_gz_sim" exec="create" name="pinky1_create" output="screen"
          args="-name $(var robot_name) -topic robot_description -x -0.6 -y -1.25 -z 0.0">
      <param name="use_sim_time" value="True"/>
    </node>
  </group>

  <!-- Robot 2 -->
  <group>
    <arg name="robot_name" default="pinky2"/>
    <push-ros-namespace ns="$(var robot_name)"/>

    <include file="$(find-pkg-share pinky_description)/launch/upload.launch.xml">
      <arg name="use_sim_time" value="True"/>
      <arg name="robot_name" value="$(var robot_name)"/>
      <arg name="tf_prefix"   value="$(var robot_name)"/>
    </include>

    <node pkg="ros_gz_sim" exec="create" name="pinky2_create" output="screen"
          args="-name $(var robot_name) -topic robot_description -x 0.0 -y -1.25 -z 0.0">
      <param name="use_sim_time" value="True"/>
    </node>
  </group>

  <!-- Robot 3 -->
  <group>
    <arg name="robot_name" default="pinky3"/>
    <push-ros-namespace ns="$(var robot_name)"/>

    <include file="$(find-pkg-share pinky_description)/launch/upload.launch.xml">
      <arg name="use_sim_time" value="True"/>
      <arg name="robot_name" value="$(var robot_name)"/>
      <arg name="tf_prefix"   value="$(var robot_name)"/>
    </include>

    <node pkg="ros_gz_sim" exec="create" name="pinky3_create" output="screen"
          args="-name $(var robot_name) -topic robot_description -x 0.6 -y -1.25 -z 0.0">
      <param name="use_sim_time" value="True"/>
    </node>
  </group>

  <node pkg="ros_gz_bridge" exec="parameter_bridge" name="parameter_bridge" output="screen"
        args="--ros-args -p config_file:=$(var bridge_params)"/>
</launch>
